#pragma semicolon 1

#define PLUGIN_AUTHOR "null138"
#define PLUGIN_VERSION "1.00"

#include <sourcemod>

#pragma newdecls required

// TODO: get these names from config itself in future
static const char cAddresses[][] = {"aVehiclerole_ptr", "aPlayerperf_ptr", "aVehicleFlushsc_ptr", \
									"aAiDebugNodeCon_ptr", "aAiSetMoveHeigh_ptr", "aPhysicsBudget_ptr" };
public Plugin myinfo = 
{
	name = "Command Exploits Fixer",
	author = PLUGIN_AUTHOR,
	description = "Fixes command exploits",
	version = PLUGIN_VERSION,
	url = "https://steamcommunity.com/id/null138/"
}

public void OnPluginStart()
{
	Address addr;
	addr = GameConfGetAddress(LoadGameConfigFile("cmdexploitsfix"), "aRptServerEnabl_ptr");
	// addr + 0xAD648 (710216) is pointer to exact line in static const char * s_clcommands[]
	if(addr) StoreToAddress(addr + view_as<Address>(0xAD648), 0x0, NumberType_Int32); 
	
	char buffer[32];
	for (int i = 0; i < sizeof(cAddresses); i++)
	{
		strcopy(buffer, 32, cAddresses[i]);
		addr = GameConfGetAddress(LoadGameConfigFile("cmdexploitsfix"), buffer);
		if(addr)
			StoreToAddress(addr, 0x0, NumberType_Int8);
	}
}